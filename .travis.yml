language: node_js
node_js:
- 6.11.0
before_script:
- sudo apt-get install curl -y
- mv node_modules/.bin/which node_modules/.bin/which.backup
- rvm install 2.4.1 && rvm use 2.4.1
- mv node_modules/.bin/which.backup node_modules/.bin/which
- cp config/database.travis.yml config/database.yml
- mkdir -p public/app
- touch public/app/index.html
- "./install_frontend.sh"
- bundle install
- bundle exec rake db:create db:migrate
- yarn install
script:
- export SECRET_TOKEN=e815982094c62436066bafc9151f2d33c4a351a776654cb7487476de260a4592
- export GCS_BUCKET=farmbot-team
- export GCS_ID=XnqcumDRnrsFdJpX5glhFpZQKSJIjZ+/lPnWkPe/
- export GCS_KEY=GOOGSDXDNLBL7DHPNZTT
- export MQTT_HOST=example.com
- export OS_UPDATE_SERVER=http://example.com
- export FW_UPDATE_SERVER=http://example.com
- export DB=postgresql
- bundle exec rspec
- npm run test
env:
  global:
  - secure: UGSE5nmMSTbYd3kipQ2zfkUVJZo0lJ8zEr+ShJnNDX73wT0Rsz6oFFSLmlsugZKXJleKybiV1ENcfrr+Ix17v/wlZY885xJLwEP5PADF92qzTzL6wXN8+X42Mxx/CdeT90blHZNOFZ/rkek2OCg3yoWG5GpBVr0B9ixj1s44zV0=
  - secure: RScG3rgjvHeJJyvcrVCLSGjSdIyzmbZ1x0OxeV7dZ4ySsKeumBon/3MJ1NU1T1f4unpB15ZJZ6vfIGXFyc+behNh+i1e+3TXh7J0AXZSKI24W6+tJL316YsRbZWWLGFEbvaFuRSJetKQFhNMsq+KarNWPskq9C79P9QSUVi02JM=
  - secure: WuCIu44fP/YXpCQNZ8lK72sYJb0crdcWY3TrgCqM4y5IYxSi9on1s/EqedqFquywd5jB/skPHHuhEiGz9CPkjErZSEm/KoaGwMlG7FVWXHq97Q7DMepqwI1pa8UERleKW6vCFIxwXX8Wm+8Pvkjgj0wSwKQzmDfY7L14ABfPAtw=
